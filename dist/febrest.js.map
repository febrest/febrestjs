{"version":3,"file":"febrest.js","sources":["../src/action/ActionVendor.js","../src/action/createActions.js","../src/action/getAction.js","../src/util/index.js","../src/action/runAction.js","../src/provider/Provider.js","../src/provider/ProviderContainer.js","../src/provider/ProviderCreator.js","../src/provider/provide.js","../src/provider/persist.js","../src/provider/RemoteProvider.js","../src/provider/SessionProvider.js","../src/provider/StorageProvider.js","../src/provider/inject.js","../src/provider/index.js","../src/action/innerActions.js","../src/error/index.js","../src/observer/Observer.js","../src/action/index.js","../src/index.js"],"sourcesContent":["'use strict'\nclass ActionVendor{\n    _actionsForKey:any;\n    constructor(){\n        this._actionsForKey = {\n            \n        }\n    }\n    putActionByKey(key:string,action){\n        this._actionsForKey[key] = action;\n    }\n    getActionForKey(key:string){\n        return this._actionsForKey[key];\n    }\n}\nconst vendor = new ActionVendor(); \n\nexport default vendor;","'use strict'\nimport ActionVendor from './ActionVendor';\n\ntype actionConfig = {\n    key: string,\n    provider?:Array,\n    persist?:Array,\n    controller?:Function\n\n}\nfunction createAction(config: actionConfig, controller) {\n   /**\n    * todo:需要优化\n    */\n    config.controller = config.controller || controller;\n    if (typeof config.controller !== 'function') {\n        throw new Error('illegal controller,the type of controller must be function,but got '+(typeof config.controller));\n    }\n    ActionVendor.putActionByKey(config.key, config);\n}\n\nfunction createActions(config){\n    if(Array.isArray(config)){\n        config.forEach(createAction);\n    }else{\n        createAction(config);\n    }\n}\nexport default createActions;","import ActionVendor from './ActionVendor';\nfunction getActionForKey(key:string){\n   return ActionVendor.getActionForKey(key)\n}\n\nexport default getActionForKey;","'use strict'\n\n\nfunction isArray(v){\n    return Array.isArray(v);\n}\nfunction isObject(v){\n    return Object.prototype.toString.call(v)==='[object Object]';\n}\nfunction isPromise(v){\n    if(typeof Promise !=='undefined' && v instanceof(Promise)){\n        return true;\n    }else{\n        return false;\n    }\n}\nfunction copy(v){\n    if(isArray(v)){\n        return v.slice();\n    }else if(isObject(v)){\n        let dest = {\n\n        }\n        for(let o in v){\n            dest[o] = copy(v[o]);\n        }\n        return dest;\n    }else{\n        return v;\n    }\n}\n\nfunction toValue(v){\n    try{\n       return JSON.parse(v);\n    }catch(e){\n        return v;\n    }\n}\n\nfunction toString(v){\n    try{\n        return JSON.stringify(v);\n    }catch(e){\n        return v;\n    }\n}\n\nfunction then(result){\n    if(isPromise(result)){\n        return result\n    }else{\n        return Promise.resolve(result);\n    }\n}\n\n/**\n * 获取参数列表\n */\nfunction getArgumentList(func): Array {\n    var argsRegExp = /function\\s*\\w*\\(([\\s\\S]*?)\\)/g;\n    if (argsRegExp.test(func.toString())) {\n        /**\n         * todo:可能有bug\n         */\n        let args = [];\n        RegExp.$1.split(',').forEach((arg) => {\n            args.push(arg.replace(/\\s/g, ''));\n        })\n        return args;\n    }\n    return [];\n}\nexport default {\n    isArray,\n    isObject,\n    copy,\n    isPromise,\n    toValue,\n    toString,\n    then,\n    getArgumentList\n}","'use strict'\n\nimport util from './../util';\n\nvar {\n    then\n} = util;\n\n\n/**\n * \n * \n * @param {any} controller \n * @param {any} args\n */\nfunction runAction(controller, args) {\n    let state = controller.apply(null, args);\n    return then(state);\n}\nexport default runAction;","'use strict'\n\n'use strict'\nimport util from './../util';\n\nvar {\n    toValue,\n    copy,\n    isArray,\n    isObject\n} = util;\n\nclass Provider{\n    _value: any;\n    _name: string;\n    constructor(config){\n        this._value = config.value;\n        this._name = config.name;\n    }\n    get(){\n        return copy(this._value);\n    }\n    set(value){\n        this._value = copy(value);\n    }\n}\n\nexport default Provider;","'use strict'\n\nimport util from './../util';\n\nvar {\n    copy\n} = util;\nvar container = {\n\n}\nfunction getProvider(name){\n    return container[name];\n}\nfunction setProvider(name,provider){\n    container[name] = provider;\n}\n\nexport default {\n    setProvider,\n    getProvider\n}","'use strict'\nimport Provider from './Provider'\nvar providerImpls = {\n    'state':Provider\n}\nfunction getProviderImpl(type:String){\n    var providerImpl = providerImpls[type];\n    if(providerImpl){\n        return providerImpl\n    }else{\n        providerImpls['state'];\n    }\n}\n\n\nfunction createProvider(config){\n    var ProviderImpls = getProviderImpl(config.type||'state');\n    return new ProviderImpls(config);\n}\nfunction use(type:String,providerImpl){\n    providerImpls[type] = providerImpl;\n}\n\nexport default {\n    createProvider,\n    use\n}","'use strict'\n\nimport util from './../util';\nimport ProviderContainer from './ProviderContainer';\nimport ProviderCreator from './ProviderCreator';\n\n\nvar {\n    isArray,\n    getArgumentList,\n    then\n} = util;\n\nvar {\n    createProvider\n} = ProviderCreator;\nvar {\n    getProvider\n} = ProviderContainer;\n\n\nfunction dependencyLookup(list, payload) {\n    var isPayloadUsed = false;\n    var args = [];\n    /**\n     * 需要优化\n    */\n    if (list) {\n        args =  list.map(function (key) {\n            let provider = ProviderContainer.getProvider(key);\n            if (provider) {\n                return then(provider.get());\n            } else if (payload && !isPayloadUsed) {\n\n                /**\n                 * payload 确保只传给第一个没匹配到的\n                 */\n                isPayloadUsed = true;\n                return then(payload);\n            } else {\n                return then(null);\n            }\n        })\n    }\n    return Promise.all(args);\n\n}\n\nfunction dependencyFromProvider(list){\n    var args = [];\n    if(list){\n        args = list.map(function(item){\n           try{\n               return then(item.get());\n           }catch(e){\n               return then(item)\n           }\n        });\n    }\n    return Promise.all(args);\n}\n\nfunction provide(action, payload) {\n    var provider = action.provider;\n    var controller = action.controller;\n    if (typeof provider === 'function') {\n        return dependencyFromProvider(provider(payload,createProvider,getProvider));\n    }else{\n        return dependencyLookup(getArgumentList(controller), payload);\n    }\n}\n\nexport default provide;","'use strict';\nimport ProviderContainer from './ProviderContainer';\nfunction persist(kv,state){\n    if(!kv){\n        return null;\n    }\n    var changed = {\n\n    }\n    for(let k in kv){\n        let v = state[k];\n\n        if(v){\n            let name = kv[k];\n            let provider = ProviderContainer.getProvider(name);\n            if(provider){\n                provider.set(v);\n                changed[name] = v;\n            }\n        }      \n    }\n    return changed;\n        \n}\n\nexport default persist;","'use strict'\nimport Provider from './Provider';\nimport util from './../util';\nclass RemoteProvider extends Provider{\n    _remote:string;\n    _params:any;\n    _method:string;\n    constructor(config){\n        super(config);\n        this._remote = config.remote;\n        this.method = config.method||'get';\n        this.body = config.body;\n        this.headers = config.headers;\n    }\n    get(){\n        var headers = undefined;\n        if(this.headers){\n            headers = new Headers(this.headers);\n        }\n        return fetch(this._remote,{\n            body:this.body,\n            method:this.method,\n            headers\n        }).then(function(response){\n            return response.text().then(function(text){\n                return util.toValue(text);\n            })\n        },function(){\n            return Promise.resolve(null);\n        })\n    }\n    set(){\n\n    }\n}\n\nexport default RemoteProvider;","'use strict'\nimport Provider from './Provider';\n\nclass SessionProvider extends Provider{\n    /**\n     * 取完之后删除数据\n     */\n    get(){\n        var value = super.get();\n        this._value = null;\n        return value;\n    }\n    \n}\nexport default SessionProvider","'use strict'\nimport Provider from './Provider';\n\nvar storageTool = {\n    getter: function () {\n        return Promise.resolve();\n    },\n    setter: function () {\n        return Promise.resolve();\n    }\n}\nclass StorageProvider extends Provider {\n    _synced: boolean;\n    constructor(config) {\n        super(config);\n    }\n    get() {\n        if (!this._synced) {\n            return storageTool.getter(this._name)\n                .then((v) => {\n                    if (v) {\n                        this._value = v.value;\n                    }\n                    this._synced = true;\n                    return super.get();\n                })\n        } else {\n            return super.get();\n        }\n    }\n    set(v) {\n        super.set(v);\n        storageTool.setter(this._name, { timestamp: Date.now(), value: v });\n\n    }\n}\nfunction setStorgaeTool(tool) {\n    storageTool = tool;\n}\n\nStorageProvider.setStorageTool = setStorgaeTool;\nexport default StorageProvider;","'use strict'\n\nimport util from './../util';\nimport ProviderContainer from './ProviderContainer';\nimport ProviderCreator from './ProviderCreator';\n\n\nvar {\n    isArray\n} = util;\n\nfunction inject(configs) {\n    if (isArray(configs)) {\n        configs.forEach(function (config) {\n            return inject(config);\n        });\n    } else {\n        var name = configs.name;\n        var value = configs.defaultValue;\n        configs.value = value;\n        var provider = ProviderCreator.createProvider(configs);\n        ProviderContainer.setProvider(name, provider);\n    }\n}\n\nexport default inject;","'use strict'\nimport Provider from './Provider';\nimport provide from './provide';\nimport persist from './persist';\nimport ProviderCreator from './ProviderCreator';\nimport ProviderContainer from './ProviderContainer';\nimport RemoteProvider from './RemoteProvider';\nimport SessionProvider from './SessionProvider';\nimport StorageProvider from './StorageProvider';\n\n\nimport inject from './inject';\n\n\n\nvar use = ProviderCreator.use;\n\nuse('storage',StorageProvider);\nuse('remote',RemoteProvider);\nuse('session',SessionProvider);\n\nexport default {\n    Provider,\n    StorageProvider,\n    RemoteProvider,\n    SessionProvider,\n    provide,\n    inject,\n    use,\n    persist,\n};","'use strict'\nconst PROVIDER_PERSIST_ACTION = 'LIBRARY/PROVIDER_PERSIST_ACTION';\nimport Provider from './../provider'\nfunction meaningless(v) {\n    return v;\n}\n\nfunction persist(payload){\n    return Provider.persist(payload.persist,payload.state);\n}\nexport default {\n    PROVIDER_PERSIST_ACTION,\n    actions: [\n        {\n            key:PROVIDER_PERSIST_ACTION,\n            controller: persist\n        }\n    ]\n};","'use strict'\nvar userErrorHandler = function(){\n    return false;\n}\n\nfunction defaultErrorHandler(error){\n   throw error;\n}\n\nfunction handle(error:Error){\n    if(!userErrorHandler(error)){\n        defaultErrorHandler(error);\n    }\n}\nfunction onError(errorHandler){\n    userErrorHandler = onError;\n}\nexport default {\n    onError,\n    handle\n}","'use strict'\n\nclass Observer{\n    constructor(){\n        this._callbacks = [];\n    }\n    next(data){\n        this._callbacks.forEach((callback)=>{\n            callback(data);\n        })\n    }\n    subscribe(callback){\n        this._callbacks.push(callback);\n    }\n    unsubscribe(callback){\n        let callbacks = this._callbacks;\n        for(let i = callbacks.length-1;i>=0;i--){\n            if(callbacks[i]===callback){\n                callbacks.splice(i,1);\n                return;\n            }\n        }\n    }\n}\n\nlet observer = new Observer();\nexport default observer;","import createActions from './createActions';\nimport getAction from './getAction';\nimport runAction from './runAction';\nimport innerActions from './innerActions';\nimport error from './../error';\nimport Provider from './../provider';\nimport Observer from './../observer';\n\n\nvar errorHandle = error.handle;\n\nvar run = function (action, payload) {\n    return Provider.provide(action, payload)\n        .then(args => runAction(action.controller, args))\n        .then(state => setResult(state, action.key))\n}\n\nvar id = 0;\n\nfunction IDGenerator() {\n    return ++id;\n}\n\nfunction providerPersist(persist, state) {\n    if (persist) {\n        exec(innerActions.PROVIDER_PERSIST_ACTION, { persist: persist, state });\n    }\n    return state;\n}\n\n\nfunction setResult(state, key) {\n    let result = {\n        state,\n        key,\n    }\n    return result;\n}\n\nfunction pushToObserver(result) {\n    Observer.next(result);\n    return result;\n}\nfunction exec(key, payload) {\n    var action = getAction(key);\n    var id = IDGenerator();\n\n    //捕获所有异常\n    run(action, payload)\n        .then(result => pushToObserver(result))\n        .then((result) => providerPersist(action.persist, result.state))\n        .catch(e => errorHandle(e))\n\n    return id;\n}\n\nfunction applyMiddleWare(middleWare) {\n    run = middleWare(run);\n}\n\n\nvar exports = {\n    createActions,\n    getAction,\n    exec: exec,\n    applyMiddleWare,\n    PROVIDER_PERSIST_ACTION: innerActions.PROVIDER_PERSIST_ACTION\n}\ncreateActions(innerActions.actions);\n\n\nexport default exports;","import action from './action';\nimport dispatcher from './dispatcher';\nimport error from './error';\nimport provider from './provider';\nimport Observer from './observer';\n\n\nvar {\n    dispatch\n} = dispatcher;\n\nvar {\n    applyMiddleWare,\n    createActions,\n    PROVIDER_PERSIST_ACTION\n} = action;\n\nvar {\n    Provider,\n    StorageProvider,\n    RemoteProvider,\n    SessionProvider,\n    inject,\n    use\n} = provider;\n\n\nmodule.exports = {\n    /**\n     * @description\n     * exports dispatch\n     */\n    dispath,\n\n    /**\n     * @description\n     * exports action\n     */\n    createActions,\n    applyMiddleWare,\n\n    /**\n     * @description\n     * exports provider\n    */\n    Provider,\n    StorageProvider,\n    RemoteProvider,\n    SessionProvider,\n    injectProvider: inject,\n    useProvider: use,\n\n    /**\n     * \n    */\n    subscribe: function (callback) {\n        return Observer.subscribe(callback);\n    },\n    unsubscribe: function (callback) {\n        return Observer.unsubscribe(callback);\n    },\n    onError: error.onError,\n\n    /**\n     * @constants\n    */\n    PROVIDER_PERSIST_ACTION\n}"],"names":["ActionVendor","_actionsForKey","key","action","vendor","createAction","config","controller","Error","putActionByKey","createActions","Array","isArray","forEach","getActionForKey","v","isObject","Object","prototype","toString","call","isPromise","Promise","copy","slice","dest","o","toValue","JSON","parse","e","stringify","then","result","resolve","getArgumentList","func","argsRegExp","test","args","$1","split","arg","push","replace","util","runAction","state","apply","Provider","_value","value","_name","name","container","getProvider","setProvider","provider","providerImpls","getProviderImpl","type","providerImpl","createProvider","ProviderImpls","use","ProviderCreator","ProviderContainer","dependencyLookup","list","payload","isPayloadUsed","map","get","all","dependencyFromProvider","item","provide","persist","kv","changed","k","set","RemoteProvider","_remote","remote","method","body","headers","undefined","Headers","fetch","response","text","SessionProvider","storageTool","StorageProvider","_synced","getter","setter","timestamp","Date","now","setStorgaeTool","tool","setStorageTool","inject","configs","defaultValue","PROVIDER_PERSIST_ACTION","userErrorHandler","defaultErrorHandler","error","handle","onError","errorHandler","Observer","_callbacks","data","callback","callbacks","i","length","splice","observer","errorHandle","run","setResult","id","IDGenerator","providerPersist","innerActions","pushToObserver","next","exec","getAction","catch","applyMiddleWare","middleWare","exports","actions","module","subscribe","unsubscribe"],"mappings":"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"}