!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";var e=new(function(){function e(){babelHelpers.classCallCheck(this,e),this._actionsForKey={}}return babelHelpers.createClass(e,[{key:"putActionByKey",value:function(e,t){this._actionsForKey[e]=t}},{key:"getActionForKey",value:function(e){return this._actionsForKey[e]}}]),e}());function t(t,r){if(t.controller=t.controller||r,"function"!=typeof t.controller)throw new Error("illegal controller,the type of controller must be function,but got "+babelHelpers.typeof(t.controller));e.putActionByKey(t.key,t)}function r(e){Array.isArray(e)?e.forEach(t):t(e)}function n(t){return e.getActionForKey(t)}function o(e){return Array.isArray(e)}function i(e){return"[object Object]"===Object.prototype.toString.call(e)}function s(e){return"undefined"!=typeof Promise&&e instanceof Promise}var u={isArray:o,isObject:i,copy:function e(t){if(o(t))return t.slice();if(i(t)){var r={};for(var n in t)r[n]=e(t[n]);return r}return t},isPromise:s,toValue:function(e){try{return JSON.parse(e)}catch(t){return e}},toString:function(e){try{return JSON.stringify(e)}catch(t){return e}},then:function(e){return s(e)?e:Promise.resolve(e)},getArgumentList:function(e){if(/function\s*\w*\(([\s\S]*?)\)/g.test(e.toString())){var t=[];return RegExp.$1.split(",").forEach(function(e){t.push(e.replace(/\s/g,""))}),t}return[]}},a=u.then;var c=u.copy,l=function(){function e(t){babelHelpers.classCallCheck(this,e),this._value=t.value,this._name=t.name}return babelHelpers.createClass(e,[{key:"get",value:function(){return c(this._value)}},{key:"set",value:function(e){this._value=c(e)}}]),e}(),f={};var p={setProvider:function(e,t){f[e]=t},getProvider:function(e){return f[e]}},v={state:l};var h={createProvider:function(e){return new(function(e){var t=v[e];if(t)return t}(e.type||"state"))(e)},use:function(e,t){v[e]=t}},b=u.getArgumentList,y=u.then,d=h.createProvider,_=p.getProvider;var P=function(e){function t(e){babelHelpers.classCallCheck(this,t);var r=babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._remote=e.remote,r.method=e.method||"get",r.body=e.body,r.headers=e.headers,r}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"get",value:function(){var e=void 0;return this.headers&&(e=new Headers(this.headers)),fetch(this._remote,{body:this.body,method:this.method,headers:e}).then(function(e){return e.text().then(function(e){return u.toValue(e)})},function(){return Promise.resolve(null)})}},{key:"set",value:function(){}}]),t}(l),g=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"get",value:function(){var e=babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"get",this).call(this);return this._value=null,e}}]),t}(l),m={getter:function(){return Promise.resolve()},setter:function(){return Promise.resolve()}},O=function(e){function t(e){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"get",value:function(){var e=this;return this._synced?babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"get",this).call(this):m.getter(this._name).then(function(r){return r&&(e._value=r.value),e._synced=!0,babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"get",e).call(e)})}},{key:"set",value:function(e){babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e),m.setter(this._name,{timestamp:Date.now(),value:e})}}]),t}(l);O.setStorageTool=function(e){m=e};var R=u.isArray;var C=h.use;C("storage",O),C("remote",P),C("session",g);var S={Provider:l,StorageProvider:O,RemoteProvider:P,SessionProvider:g,provide:function(e,t){var r,n,o=e.provider,i=e.controller;return"function"==typeof o?(r=o(t,d,_),n=[],r&&(n=r.map(function(e){try{return y(e.get())}catch(t){return y(e)}})),Promise.all(n)):function(e,t){var r=!1,n=[];return e&&(n=e.map(function(e){var n=p.getProvider(e);return n?y(n.get()):t&&!r?(r=!0,y(t)):y(null)})),Promise.all(n)}(b(i),t)},inject:function e(t){if(R(t))t.forEach(function(t){return e(t)});else{var r=t.name,n=t.defaultValue;t.value=n;var o=h.createProvider(t);p.setProvider(r,o)}},use:C,persist:function(e,t){if(!e)return null;var r={};for(var n in e){var o=t[n];if(o){var i=e[n],s=p.getProvider(i);s&&(s.set(o),r[i]=o)}}return r}};var k={PROVIDER_PERSIST_ACTION:"LIBRARY/PROVIDER_PERSIST_ACTION",actions:[{key:"LIBRARY/PROVIDER_PERSIST_ACTION",controller:function(e){return S.persist(e.persist,e.state)}}]},A=function(){return!1};var I={onError:function e(t){A=e},handle:function(e){A(e)||function(e){throw e}(e)}},E=new(function(){function e(){babelHelpers.classCallCheck(this,e),this._callbacks=[]}return babelHelpers.createClass(e,[{key:"next",value:function(e){this._callbacks.forEach(function(t){t(e)})}},{key:"subscribe",value:function(e){this._callbacks.push(e)}},{key:"unsubscribe",value:function(e){for(var t=this._callbacks,r=t.length-1;r>=0;r--)if(t[r]===e)return void t.splice(r,1)}}]),e}()),H=I.handle,T=function(e,t){return S.provide(e,t).then(function(t){return function(e,t){var r=e.apply(null,t);return a(r)}(e.controller,t)}).then(function(t){return function(e,t){return{state:e,key:t}}(t,e.key)})},j=0;function V(){return++j}function N(e,t){var r=n(e),o=V();return T(r,t).then(function(e){return function(e){return E.next(e),e}(e)}).then(function(e){return t=r.persist,n=e.state,t&&N(k.PROVIDER_PERSIST_ACTION,{persist:t,state:n}),n;var t,n}).catch(function(e){return H(e)}),o}var w={createActions:r,getAction:n,exec:N,applyMiddleWare:function(e){T=e(T)},PROVIDER_PERSIST_ACTION:k.PROVIDER_PERSIST_ACTION};r(k.actions);var D=w.applyMiddleWare,x=w.createActions,K=w.PROVIDER_PERSIST_ACTION,F=S.Provider,B=S.StorageProvider,L=S.RemoteProvider,M=S.SessionProvider,W=S.inject,J=S.use;module.exports={dispath:dispath,createActions:x,applyMiddleWare:D,Provider:F,StorageProvider:B,RemoteProvider:L,SessionProvider:M,injectProvider:W,useProvider:J,subscribe:function(e){return E.subscribe(e)},unsubscribe:function(e){return E.unsubscribe(e)},onError:I.onError,PROVIDER_PERSIST_ACTION:K}});
//# sourceMappingURL=febrest.min.js.map
